webpackJsonp([8],{22:function(a,b){"use strict";a.exports=function(a){a.controller("adminCtrl",["$scope","api","lodash","$modal",function(a,b,c,d){a.alerts=[],a.users=[],a.newUser={first_name:"",last_name:"",email:"",password:""},a.addPlan=function(){d.open({templateUrl:"modules/dashboard/views/admin/new-plan-modal.html",controller:"newPlanPopup"})},a.deactivatePlan=function(c,d){b.put("admin","plans",c,{},function(b,c){a.alerts.push({type:"info",msg:c.userMessage}),a.plans[d].active=!a.plans[d].active})},a.closeAlert=function(b){a.alerts.splice(b,1)},a.viewUser=function(a){d.open({templateUrl:"modules/dashboard/views/admin/modal.html",controller:"viewUserPopup",resolve:{_id:function(){return a}}})},a.addUser=function(){a.alerts=[],a.show_form=!0,b.post("admin","users",a.newUser,function(b,d){b?a.alerts.push({type:"danger",msg:"Server error."}):d.error?c.each(d.errors,function(b,c){a.alerts.push({type:"danger",msg:b.msg})}):(a.alerts.push({type:"info",msg:"User added"}),a.users.push(d.user))})},a.getUsers=function(){b.get("admin","users",!1,{},function(b,c){b?a.alerts.push({type:"danger",msg:"Server error."}):c.error?console.log(c):a.users=c.data.users})},a.getPlans=function(){b.get("admin","plans",!1,{},function(b,c){b?a.alerts.push({type:"danger",msg:"Server error."}):c.error?console.log(c):a.plans=c.data.plans})}}]),a.controller("viewUserPopup",["$scope","$modalInstance","api","_id",function(a,b,c,d){c.get("users",d,!1,{},function(b,c){a.profile=c.data.profile}),a.ok=function(){b.close(a.selected.item)},a.cancel=function(){b.dismiss("cancel")}}]),a.controller("newPlanPopup",["$scope","$modalInstance","api",function(a,b,c){a.activateButtonShow=!1;var d=function(){a.newPlan={name:"",description:"",emails:"",text:"",voice:"",members:"",price:"",plan_type:1}};d(),a.activatePlan=function(){c.put("admin","plans",a.plan._id,{},function(b,c){b?a.msg="Server error":a.msg=c.userMessage||"Plan actiavated"})};var e=function(b){c.post("admin","plans/paypal",{name:b.name,description:b.description,plan_id:b._id},function(b,c){b?a.msg="Server error":c.error?a.msg=c.userMessage:(a.msg="Paypal subscription created.",a.activateButtonShow=!0)})};a.addPlan=function(){c.post("admin","plans",a.newPlan,function(b,c){b?a.msg="Server error":c.error?a.msg=c.userMessage:(a.msg="Added plan, now trying to create paypal subscription for this",a.plan=c.data.plan,e(c.data.plan))})},a.ok=function(){b.close(a.selected.item)},a.cancel=function(){b.dismiss("cancel")}}])}}});